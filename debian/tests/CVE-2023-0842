#!/usr/bin/node
var parseString = require('xml2js').parseString;

let normal_user_request    = "<role>admin</role>";
let malicious_user_request = "<__proto__><role>admin</role></__proto__>";

const update_user = (userProp) => {
    // A user cannot alter his role. This way we prevent privilege escalations.
    parseString(userProp, function (err, user) {
        if (userProp === malicious_user_request && user?.role && user.role[0]) {
            throw new Error('Vulnerable to CVE-2023-0842');
        }
    });
}

update_user(normal_user_request);
update_user(malicious_user_request);
